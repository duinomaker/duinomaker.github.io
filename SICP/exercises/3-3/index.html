<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 6.3.0"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="format-detection" content="telephone=no"><title>3.3 Modeling with Mutable Data - duinomaker&#39;s blog</title><meta name="description" content="Solutions to exercises in SICP section 3.3 - Modeling with Mutable Data"><meta property="og:type" content="website"><meta property="og:title" content="3.3 Modeling with Mutable Data"><meta property="og:url" content="https://duinomaker.top/SICP/exercises/3-3/"><meta property="og:site_name" content="duinomaker&#39;s blog"><meta property="og:description" content="Solutions to exercises in SICP section 3.3 - Modeling with Mutable Data"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://duinomaker.top/images/og_image.png"><meta property="article:published_time" content="2021-05-13T01:30:00.000Z"><meta property="article:modified_time" content="2021-07-21T02:57:21.000Z"><meta property="article:author" content="duinomaker"><meta property="article:tag" content="mathematics"><meta property="article:tag" content="programming"><meta property="article:tag" content="algorithm"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://duinomaker.top/images/og_image.png"><meta name="twitter:creator" content="@duinomaker"><meta name="twitter:site" content="@duinomaker"><meta property="fb:admins" content="100043022235251"><link rel="canonical" href="https://duinomaker.top/SICP/exercises/3-3/"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin="anonymous"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="apple-touch-icon" type="image/png" sizes="57x57" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" type="image/png" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" type="image/png" sizes="72x72" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" type="image/png" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="icon" type="image/svg+xml" href="/images/favicon.svg"><link rel="alternate icon" type="image/png" href="/images/favicon.png"><link rel="shortcut icon" type="image/x-icon" sizes="32x32" href="/images/favicon-32x32.ico"><link rel="shortcut icon" type="image/x-icon" sizes="16x16" href="/images/favicon-16x16.ico"><link rel="preload" href="/assets/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous"><link rel="preload" href="/assets/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@latest/css/bulma.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,italic,500,500italic|Source+Code+Pro|Alegreya:400,italic,500,500italic"><link rel="stylesheet" href="/assets/font-awesome/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@latest/styles/atom-one-light.min.css"><link rel="stylesheet" href="/assets/style.css"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand is-flex-center"> <a class="navbar-item navbar-logo" href="/"><img src="/images/misc/logo.svg" alt="3.3 Modeling with Mutable Data" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"> <a class="navbar-item" href="/">Home</a> <a class="navbar-item" href="/archives/">Archives</a> <a class="navbar-item" href="/categories/">Categories</a> <a class="navbar-item" href="/notes/">Notes</a> <a class="navbar-item" href="/about/">About</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;" rel="external nofollow noreferrer"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column is-12 has-order-2 column-main"><div class="card"><div class="card-content article"><div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto"><div class="level-left"> <time class="level-item has-text-grey" datetime="2021-05-13T01:30:00.000Z">May 13, 2021</time><span class="level-item has-text-grey"><i class="fas fa-user"></i> &nbsp;<a class="has-link-grey" rel="author" href="https://duinomaker.top/">duinomaker</a></span></div></div><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal serif"> 3.3 Modeling with Mutable Data</h1><div class="content has-math serif"><style>strong{font-weight:500}</style><style>.article .content{font-size:1.2rem}</style><hr><h2 id="Exercise-3-12"><a href="#Exercise-3-12" class="headerlink" title="Exercise 3.12"></a>Exercise 3.12</h2><pre><code>(a b)
(a b c d)
</code></pre><h2 id="Exercise-3-13"><a href="#Exercise-3-13" class="headerlink" title="Exercise 3.13"></a>Exercise 3.13</h2><p>The programs will be caught in an infinite recursion.</p><h2 id="Exercise-3-14"><a href="#Exercise-3-14" class="headerlink" title="Exercise 3.14"></a>Exercise 3.14</h2><pre><code>v
(a)

w
(d c b a)
</code></pre><h2 id="Exercise-3-16"><a href="#Exercise-3-16" class="headerlink" title="Exercise 3.16"></a>Exercise 3.16</h2><pre><code>p1-&gt;p2-&gt;p3
(count-pairs p1)
3

p1-&gt;p2=&gt;p3
(count-pairs p1)
4

p1=&gt;p2=&gt;p3
(count-pairs p1)
7
</code></pre><p>in which <code>a-&gt;b</code> means <code>(define a (cons &#39;non-pair b))</code> and <code>a=&gt;b</code> means <code>(define a (cons b b))</code>.</p><h2 id="Exercise-3-17"><a href="#Exercise-3-17" class="headerlink" title="Exercise 3.17"></a>Exercise 3.17</h2><p>Maintain a local list of encountered pairs; only count a pair if it hasn’t been encountered.</p><pre><code>(define (count-pairs x)
  (let ((encountered-pairs &#39;()))
    (define (encountered? p remaining-pairs)
      (if (null? remaining-pairs)
          false
          (if (eq? p (car remaining-pairs))
              true
              (encountered? p (cdr remaining-pairs)))))
    (define (count-unencountered-pairs y)
      (if (not (pair? y))
          0
          (+ (count-unencountered-pairs (car y))
             (count-unencountered-pairs (cdr y))
             (if (encountered? y encountered-pairs)
                 0
                 (begin (set! encountered-pairs
                              (cons y encountered-pairs))
                        1)))))
    (count-unencountered-pairs x)))
</code></pre><h2 id="Exercises-3-18–3-19"><a href="#Exercises-3-18–3-19" class="headerlink" title="Exercises 3.18–3.19"></a>Exercises 3.18–3.19</h2><p>I came up with this solution during a post-shower daze time, when creativity peaks (x. The idea is to have two sentinels running through the linked list at different speeds, for example, one takes one <code>cdr</code> at a time while the other takes two <code>cdr</code>’s. If one sentinel reaches the end, the linked list cannot have a loop; otherwise a sentinel chases the other inside a loop and will eventually “catch” the other. The program is given below.</p><pre><code>(define (has-loop? l)
  (define (scdr l)
    (if (pair? l)
        (cdr l)
        &#39;()))
  (define (iter s1 s2)
    (cond ((or (null? s1) (null? s2)) false)
          ((eq? s1 s2) true)
          (else (iter (scdr s1) (scdr (scdr s2))))))
  (iter l (scdr l)))
</code></pre><h2 id="Exercise-3-21"><a href="#Exercise-3-21" class="headerlink" title="Exercise 3.21"></a>Exercise 3.21</h2><pre><code>(define (print-queue queue)
  (display (front-ptr queue)))
</code></pre><h2 id="Exercise-3-22"><a href="#Exercise-3-22" class="headerlink" title="Exercise 3.22"></a>Exercise 3.22</h2><pre><code>(define (make-queue)
  (let ((front-ptr &#39;())
        (rear-ptr &#39;()))
    (define (empty?)
      (null? front-ptr))
    (define (insert! item)
      (if (empty?)
        (let ((new-pair (list item)))
          (set! front-ptr new-pair)
          (set! rear-ptr new-pair))
        (let ((new-pair (list item)))
          (set-cdr! rear-ptr new-pair)
          (set! rear-ptr new-pair))))
    (define (get)
      (if (empty?)
          (error &quot;ERROR&quot;)
          (car front-ptr)))
    (define (delete!)
      (let ((result (get)))
        (begin (set! front-ptr
                     (cdr front-ptr)))))
    (define (dispatch m)
      (cond ((eq? m &#39;empty?) empty?)
            ((eq? m &#39;insert!) insert!)
            ((eq? m &#39;delete!) delete!)
            ((eq? m &#39;get) get)))
    dispatch))
</code></pre><h2 id="Exercise-3-23"><a href="#Exercise-3-23" class="headerlink" title="Exercise 3.23"></a>Exercise 3.23</h2><p>In order to delete the rear element of a deque and to be able to move the rear pointer backwards, I created a bi-directed structure <code>node</code> which, in contrast to ordinary list structure, also keep a record of its preceding node.</p><pre><code>(define (node prev item next)
  (cons item (cons prev next)))

(define (prev-node node)
  (cadr node))

(define (next-node node)
  (cddr node))

(define (make-deque)
  (cons &#39;() &#39;()))

(define (deque-empty? dq)
  (null? (car dq)))

(define (deque-front dq)
  (if (deque-empty? dq)
      (error &quot;ERROR - Accessing a member of an empty deque&quot;)
      (caar dq)))

(define (deque-rear dq)
  (if (deque-empty? dq)
      (error &quot;ERROR - Accessing a member of an empty deque&quot;)
      (cadr dq)))

(define (deque-delete-front! dq)
  (if (deque-empty? dq)
      (error &quot;ERROR - Deleting a member of an empty deque&quot;)
      (set-car! dq
                (next-node (car dq)))))

(define (deque-delete-rear! dq)
  (if (deque-empty? dq)
      (error &quot;ERROR - Deleting a member of an empty deque&quot;)
      (set-cdr! dq
                (prev-node (cdr dq)))))

(define (deque-insert-front! dq item)
  (if (deque-empty? dq)
      (let ((new-node (node &#39;() item &#39;())))
        (set-car! dq new-node)
        (set-cdr! dq new-node))
      (let ((original-node (car dq)))
        (set-car! dq
                  (node &#39;() item original-node))
        (set-cdr! (cdar dq)
                  original-node))))

(define (deque-insert-rear! dq item)
  (if (deque-empty? dq)
      (let ((new-node (node &#39;() item &#39;())))
        (set-car! dq new-node)
        (set-cdr! dq new-node))
      (let ((original-node (cdr dq)))
        (set-cdr! dq
                  (node original-node item &#39;()))
        (set-car! (cddr dq)
                  original-node))))
</code></pre><h2 id="Exercise-3-24"><a href="#Exercise-3-24" class="headerlink" title="Exercise 3.24"></a>Exercise 3.24</h2><pre><code>(define (same-key? k1 k2)
  (cond ((and (number? k1) (number? k2))
         (&lt; (abs (- k1 k2)) 0.00001))
        ((and (symbol? k1) (symbol? k2))
         (equal? k1 k2))
        (else false)))
</code></pre><h2 id="Exercise-3-25"><a href="#Exercise-3-25" class="headerlink" title="Exercise 3.25"></a>Exercise 3.25</h2><p>To simplify the problem, I made the assumption that the users only index the table with key sequences of the same length.</p><pre><code>(define (make-table)
  (let ((local-table (list &#39;*table*)))
    (define (lookup keys)
      (define (iter keys table)
        (if (null? keys)
            table
            (let ((subtable (assoc (car keys) table)))
              (if subtable
                  (iter (cdr keys) (cdr subtable))
                  false))))
      (iter keys (cdr local-table)))
    (define (insert! keys value)
      (define (new-record keys value)
        (if (null? keys)
            value
            (list (cons (car keys)
                        (new-record (cdr keys) value)))))
      (define (iter keys table)
        (let ((subtable (assoc (car keys) table)))
          (if subtable
              (if (null? (cdr keys))
                  (set-cdr! subtable
                            (cons (cons (car keys) value)
                                  (cdr subtable)))
                  (iter (cdr keys) (cdr subtable)))
              (set-cdr! table
                        (cons (car (new-record keys value))
                              (cdr table))))))
      (if (null? (cdr local-table))
          (set-cdr! local-table
                    (new-record keys value))
          (iter keys (cdr local-table))))
    (define (dispatch m)
      (cond ((eq? m &#39;lookup-proc) lookup)
            ((eq? m &#39;insert-proc!) insert!)
            (else (error &quot;Unknown operation -- TABLE&quot; m))))
    dispatch))
</code></pre><p>A simple example of using the table:</p><pre><code>(define t (make-table))
((t &#39;insert-proc!) &#39;(1 3 5 7) &#39;odd)
((t &#39;insert-proc!) &#39;(2 4 6 8) &#39;even)

((t &#39;lookup-proc) &#39;(1 3 5 7))
odd

((t &#39;lookup-proc) &#39;(4 3 2 1))
#f
</code></pre><h2 id="Exercise-3-26"><a href="#Exercise-3-26" class="headerlink" title="Exercise 3.26"></a>Exercise 3.26</h2><p>Replace the lists of indices with binary trees of indices and <code>assoc</code> with binary trees’ <code>lookup</code>. In addition, create a procedure for comparing key sequences, like this one below.</p><pre><code>(define (key-less-than k1 k2)
  (cond ((null? k1) true)
        ((&lt; (car k1) (car k2)) true)
        (else (key-less-than (cdr k1) (cdr k2)))))
</code></pre><h2 id="Exercise-3-27"><a href="#Exercise-3-27" class="headerlink" title="Exercise 3.27"></a>Exercise 3.27</h2><p>Each <code>memo-fib</code> first calculates the first branch, then the second branch. When <code>(memo-fib n)</code> is called, it will calculate <code>(memo-fib n-1)</code>, then <code>(memo-fib n-2)</code>… until with <code>(memo-fib 1)</code>; after which, all <code>memo-fib</code> starts to calculate the second branch, that is, <code>(memo-fib 0)</code> until <code>(memo-fib n-2)</code>; each of them uses values that are already memorized and takes a constant number of steps; since there are $n$ <code>memo-fib</code> calls, <code>(memo-fib n)</code> runs in a number of steps proportional to $n$.</p><p><code>(define memo-fib (memorize fib))</code> won’t work. In the call of <code>(memo-fib n)</code>, it calls the non-memorized version <code>fib</code>, which takes exponential time to evaluate.</p><h2 id="Exercise-3-28"><a href="#Exercise-3-28" class="headerlink" title="Exercise 3.28"></a>Exercise 3.28</h2><pre><code>(define (or-gate a1 a2 output)
  (define (or-action-procedure)
    (let ((new-value
           (logical-or (get-signal a1) (get-signal a2))))
      (after-delay or-gate-delay
                   (lambda ()
                     (set-signal! output new-value)))))
  (add-action! a1 or-action-procedure)
  (add-action! a2 or-action-procedure)
  &#39;ok)
</code></pre><h2 id="Exercise-3-29"><a href="#Exercise-3-29" class="headerlink" title="Exercise 3.29"></a>Exercise 3.29</h2><pre><code>(define (or-gate a1 a2 output)
  (let ((s1 (make-wire))
        (s2 (make-wire))
        (s3 (make-wire)))
    (inverter a1 s1)
    (inverter a2 s2)
    (and-gate s1 s2 s3)
    (inverter s3 output)
    &#39;ok))
</code></pre><h2 id="Exercise-3-30"><a href="#Exercise-3-30" class="headerlink" title="Exercise 3.30"></a>Exercise 3.30</h2><pre><code>(define (ripple-carry-adder a b c-out sum)
  (let ((c-in (make-wire)))
    (if (null? a)
        (set-signal! c-out 0)
        (begin
         (ripple-carry-adder (cdr a) (cdr b) c-in (cdr sum))
         (full-adder (car a) (car b) c-in (car sum) c))))
  &#39;ok)
</code></pre><blockquote><p>TODO</p></blockquote><h2 id="Exercise-3-31"><a href="#Exercise-3-31" class="headerlink" title="Exercise 3.31"></a>Exercise 3.31</h2><p>If the procedures are not immediately run, all wires will have $0$ as their <code>signal-value</code>, which would fail on the encounter of an inverter, which have different signal values on both ends. Take the half-adder in <a href="#fig-1">figure 1</a> as an example, when <code>A</code> changes from $0$ to $1$ while <code>B</code> keeps $0$ unchanged, the and-gate before <code>S</code> would produce $0$ rather than the expected result $1$, due to a failure of the inverter.</p><figure class="image" id="fig-1"> <img src="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/ch3-Z-G-25.gif" class="image illustration" alt="Fig 1: A half-adder circuit."></figure><h2 id="Exercise-3-32"><a href="#Exercise-3-32" class="headerlink" title="Exercise 3.32"></a>Exercise 3.32</h2><p>If the result of a logical gate depends on its inputs, it cannot produce the correct value before its inputs are correctly produced.</p><h2 id="Exercise-3-33"><a href="#Exercise-3-33" class="headerlink" title="Exercise 3.33"></a>Exercise 3.33</h2><pre><code>(define (averager a b c)
  (define (process-new-value)
    (cond ((and (has-value? a) (has-value? b))
           (set-value! c
                       (/ (+ (get-value a) (get-value b)) 2)
                       me))
          ((and (has-value? a) (has-value? c))
           (set-value! b
                       (- (* (get-value c) 2) (get-value a))
                       me))
          ((and (has-value? b) (has-value? c))
           (set-value! a
                       (- (* (get-value c) 2) (get-value b))
                       me))))
  (define (process-forget-value)
    (forget-value! a me)
    (forget-value! b me)
    (forget-value! c me)
    (process-new-value))
  (define (me request)
    (cond ((eq? request &#39;I-have-a-value)
           (process-new-value))
          ((eq? request &#39;I-lost-my-value)
           (process-forget-value))
          (else
           (error &quot;Unknown request -- AVERAGER&quot; request))))
  (connect a me)
  (connect b me)
  (connect c me)
  me)
</code></pre><h2 id="Exercise-3-34"><a href="#Exercise-3-34" class="headerlink" title="Exercise 3.34"></a>Exercise 3.34</h2><p>The multiplier requires values of two connectors to infer the value of the thrid connector. When connector <code>b</code> is set, the multiplier cannot infer the value of <code>a</code> from <code>b</code>.</p><h2 id="Exercise-3-35"><a href="#Exercise-3-35" class="headerlink" title="Exercise 3.35"></a>Exercise 3.35</h2><p>Assume that if the connector <code>a</code> has a value, it is always non-negative.</p><pre><code>(define (squarer a b)
  (define (process-new-value)
    (if (has-value? b)
        (if (&lt; (get-value b) 0)
            (error &quot;square less than 0 -- SQUARER&quot; (get-value b))
            (set-value! a (sqrt b) me))
        (if (has-value? a)
            (set-value! b (square a) me))))
  (define (process-forget-value)
    (forget-value! a me)
    (forget-value! b me))
  (define (me request)
    (cond ((eq? request &#39;I-have-a-value)
           (process-new-value))
          ((eq? request &#39;I-lost-my-value)
           (process-forget-value))
          (else
           (error &quot;Unknown request -- SQUARER&quot; request))))
  (connect a me)
  (connect b me)
  me)
</code></pre><h2 id="Exercise-3-37"><a href="#Exercise-3-37" class="headerlink" title="Exercise 3.37"></a>Exercise 3.37</h2><pre><code>(define (c- x y)
  (let ((z (make-connector)))
    (adder x z y)
    z))

(define (c* x y)
  (let ((z (make-connector)))
    (multiplier x y z)
    z))

(define (c/ x y)
  (let ((z (make-connector)))
    (multiplier x z y)
    z))

(define (cv value)
  (let ((z (make-connector)))
    (constant value z)
    z))
</code></pre></div></div></div><div class="card"><div class="card-content"><h3 class="title is-5 has-text-weight-normal">Comments</h3><div id="valine-thread" class="content"></div><script src="https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script>new Valine({el:"#valine-thread",notify:!1,verify:!1,app_id:"jUDJCYuOij3UzEzFmRpQer5U-gzGzoHsz",app_key:"h2AVOMeF8QsLYFdVVbbf9d7k",placeholder:"Suggestions are welcome.",lang:"en"})</script></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start has-text-centered-mobile has-mb-6-mobile"><p>This work is licensed under a <a rel="license noopener external nofollow noreferrer" title="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons License</a></p></div><div class="level-end has-text-centered-mobile has-mb-5-mobile"><p class="is-size-7">&copy;&nbsp;2020<span style="padding-left:.06em">–</span>2023&nbsp;duinomaker<span>&nbsp;&nbsp;|&nbsp;&nbsp;</span><i class="fas fa-file-word"></i>&nbsp;57.5k&nbsp;words in total<span>&nbsp;&nbsp;|&nbsp;&nbsp;</span><a class="has-link-black-ter" rel="license noopener external nofollow noreferrer" title="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"><i class="fab fa-creative-commons"></i>&nbsp;&nbsp;<i class="fab fa-creative-commons-by"></i>&nbsp;&nbsp;<i class="fab fa-creative-commons-nc"></i>&nbsp;&nbsp;<i class="fab fa-creative-commons-sa"></i></a></p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script>var IcarusThemeSettings={site:{url:"https://duinomaker.top",external_link:{enable:!0,exclude:[]}},article:{highlight:{clipboard:!1,fold:"unfolded"}}}</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js" defer="defer"></script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js" defer="defer"></script><script>document.addEventListener("DOMContentLoaded",function(){for(contents=document.getElementsByClassName("has-math"),i=0;i<contents.length;++i)renderMathInElement(contents[i],{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><script src="/assets/main.js" defer="defer"></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"> <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},CONTENT_URL:"/assets/content.json"}</script><script src="/assets/insight.js" defer="defer"></script><link rel="stylesheet" href="/assets/search.css"><link rel="stylesheet" href="/assets/insight.css"></body></html>