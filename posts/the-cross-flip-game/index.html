<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 6.3.0"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="format-detection" content="telephone=no"><title>“十字翻转棋问题” 的解法 - duinomaker&#39;s blog</title><meta name="description" content="十字翻转棋问题有更巧妙的解法吗？线性代数带给我们不少启发。"><meta property="og:type" content="article"><meta property="og:title" content="“十字翻转棋问题” 的解法"><meta property="og:url" content="https://duinomaker.top/posts/the-cross-flip-game/"><meta property="og:site_name" content="duinomaker&#39;s blog"><meta property="og:description" content="十字翻转棋问题有更巧妙的解法吗？线性代数带给我们不少启发。"><meta property="og:locale"><meta property="og:image" content="https://duinomaker.top/images/og_image.png"><meta property="article:published_time" content="2020-02-11T14:34:37.000Z"><meta property="article:modified_time" content="2021-04-01T04:13:48.000Z"><meta property="article:author" content="duinomaker"><meta property="article:tag" content="Linear Algebra"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://duinomaker.top/images/og_image.png"><meta name="twitter:creator" content="@duinomaker"><meta name="twitter:site" content="@duinomaker"><meta property="fb:admins" content="100043022235251"><link rel="canonical" href="https://duinomaker.top/posts/the-cross-flip-game/"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin="anonymous"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="apple-touch-icon" type="image/png" sizes="57x57" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" type="image/png" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" type="image/png" sizes="72x72" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" type="image/png" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="icon" type="image/svg+xml" href="/images/favicon.svg"><link rel="alternate icon" type="image/png" href="/images/favicon.png"><link rel="shortcut icon" type="image/x-icon" sizes="32x32" href="/images/favicon-32x32.ico"><link rel="shortcut icon" type="image/x-icon" sizes="16x16" href="/images/favicon-16x16.ico"><link rel="preload" href="/assets/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous"><link rel="preload" href="/assets/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@latest/css/bulma.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,italic,500,500italic|Source+Code+Pro|Alegreya:400,italic,500,500italic"><link rel="stylesheet" href="/assets/font-awesome/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@latest/styles/atom-one-light.min.css"><link rel="stylesheet" href="/assets/style.css"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand is-flex-center"> <a class="navbar-item navbar-logo" href="/"><img src="/images/misc/logo.svg" alt="“十字翻转棋问题” 的解法" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"> <a class="navbar-item" href="/">Home</a> <a class="navbar-item" href="/archives/">Archives</a> <a class="navbar-item" href="/categories/">Categories</a> <a class="navbar-item" href="/notes/">Notes</a> <a class="navbar-item" href="/about/">About</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;" rel="external nofollow noreferrer"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column is-12 has-order-2 column-main"><div class="card"><div class="card-content article"><div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto"><div class="level-left"> <time class="level-item has-text-grey" datetime="2020-02-11T14:34:37.000Z">February 11, 2020</time><span class="level-item has-text-grey"><i class="fas fa-user"></i> &nbsp;<a class="has-link-grey" rel="author" href="https://duinomaker.top/">duinomaker</a></span></div></div><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"> “十字翻转棋问题” 的解法</h1><div class="content has-math"><style>.article .title,.article h1,.article h2,.article h3,.article h4,.article h5,.article h6{font-family:"Microsoft YaHei",sans-serif}</style><p>十字翻转棋问题有更巧妙的解法吗？线性代数带给我们不少启发。</p><span id="more"></span><hr><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>“传火” 这个游戏，需要点燃 $16$ 个火堆。<br>每个火堆可以处于以下两种状态之一：点燃或熄灭。<br>这 $16$ 个火堆可以表示为一个 $4\times4$ 的方阵，可以对任何一个位置上的火堆进行 “切换”。<br>例如，对 $[i,j]$ 位置的火堆进行切换，会使得第 $i$ 行和第 $j$ 列上的所有火堆的状态也随着改变。<br>要求最终所有的火堆都被点亮。</p><h3 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h3><p>输入一共包含 $4$ 行，每行包含 $4$ 个火堆的初始状态。<br>符号 “<code>+</code>” 表示火堆处于熄灭状态，而符号 “<code>-</code>” 表示火堆处于燃烧状态。<br>输入数据保证至少一个火堆的初始状态是熄灭的。</p><h3 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h3><p>第一行输出一个整数 $N$，表示所需的最少切换次数。<br>接下来 $N$ 行描述切换顺序，每行输入两个整数，代表被切换状态的火堆的行号和列号，数字之间用空格隔开。<br>切换动作按照整体从上到下、同行从左到右的顺序输出。</p><h3 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h3><p>输入样例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+++-</span><br><span class="line">+--+</span><br><span class="line">+--+</span><br><span class="line">-+++</span><br></pre></td></tr></table></figure><p>输出样例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">1 1</span><br><span class="line">4 4</span><br></pre></td></tr></table></figure><h2 id="思路与题解"><a href="#思路与题解" class="headerlink" title="思路与题解"></a>思路与题解</h2><p>最直接的思路当然是递归枚举所有可能的切换方式了。先枚举只切换一次的 $16$ 种情况，再枚举切换两次的 $15\times15$ 种情况，以此类推。</p><p>由此看来，这样做效率十分低下。假设最少切换次数是 $12$，运算量也可以达到 $10^9$ 数量级，根本无法应对需要更多切换次数的情况。</p><p>所以我们引入如下方法，首先给这 $16$ 个火堆编号：</p><p>$$\begin{array}{|c|c|c|c|}\hline1&amp;2&amp;3&amp;4\\\hline5&amp;6&amp;7&amp;8\\\hline9&amp;10&amp;11&amp;12\\\hline13&amp;14&amp;15&amp;16\\\hline\end{array}$$</p><p>用 $b_i$ 表示第 $i$ 个火堆的状态，$b_i$ 取值 $1$ 为熄灭状态，取值 $0$ 为燃烧状态。样例中，$b$ 就可以如此表示为如下的 “状态向量”：</p><p>$$b=(1,1,1,0,1,0,0,1,1,0,0,1,0,1,1,1)^{\rm T}$$</p><p>接下来定义向量 $x$，用 $x_i$ 表示是否需要对第 $i$ 个火堆进行切换，是为 $1$，不是为 $0$&hairsp;。我们发现，火堆状态的切换可以用<strong>异或运算</strong>来表示；又由于火堆最终都将处于熄灭状态，我们可以对第一个火堆列出方程，并化简：</p><p>$$b_1\oplus x_1\oplus x_2\oplus x_3\oplus x_4\oplus x_5\oplus x_9\oplus x_{13} = 0$$</p><p>$$x_1\oplus x_2\oplus x_3\oplus x_4\oplus x_5\oplus x_9\oplus x_{13} = b_1$$</p><p>类似地，可以对第 $2,3,\ldots,16$ 个火堆列出方程，并组成方程组：</p><p>$$\begin{cases}x_1\oplus x_2\oplus x_3\oplus x_4\oplus x_5\oplus x_9\oplus x_{13}&amp;=&amp;b_1\\x_1\oplus x_2\oplus x_3\oplus x_4\oplus x_6\oplus x_{10}\oplus x_{14}&amp;=&amp;b_2\\\qquad\qquad\cdots\\x_4\oplus x_8\oplus x_{12}\oplus x_{13}\oplus x_{14}\oplus x_{15}\oplus x_{16}&amp;=&amp;b_{16}\end{cases}$$</p><p>于是，求解哪些火堆需要切换的问题则转化为了求解方程组的问题。</p><p>到了这一步，你的线性代数知识是否已被唤起？这里不再是线性方程组，而将线性方程中的加法换为异或，变为了 “异或方程组”，同样可以化为矩阵形式：</p><p>$$Ax=b\quad\Leftrightarrow\quad\left[\begin{array}{c}\textcolor{red}{1}\,\textcolor{red}{1}\,\textcolor{red}{1}\,\textcolor{red}{1}\,\textcolor{red}{1}\,0\,0\,0\,\textcolor{red}{1}\,0\,0\,0\,\textcolor{red}{1}\,0\,0\,0\\\textcolor{red}{1}\,\textcolor{red}{1}\,\textcolor{red}{1}\,\textcolor{red}{1}\,0\,\textcolor{red}{1}\,0\,0\,0\,\textcolor{red}{1}\,0\,0\,0\,\textcolor{red}{1}\,0\,0\\\cdots\;\text{another 13 lines}\;\cdots\\0\,0\,0\,\textcolor{red}{1}\,0\,0\,0\,\textcolor{red}{1}\,0\,0\,0\,\textcolor{red}{1}\,\textcolor{red}{1}\,\textcolor{red}{1}\,\textcolor{red}{1}\,\textcolor{red}{1}\end{array}\right]x=b$$</p><p>利用高斯消元法，对增广矩阵 $[A|b]$ 进行初等行变换（只包括行之间的异或运算），直到矩阵 $A$ 化为单位矩阵；而变换后的状态向量 $b$ 便成了我们需要求解的 $x$ 向量。</p><p>最后根据向量 $x$，按顺序输出即可。</p><p>如此，$4\times4$ 的 “传火” 问题，甚至是 $m\times n$ 的十字翻转棋问题，便能在 $O((mn)^2)$ 的时间复杂度下解决了。</p><h2 id="参考代码"><a href="#参考代码" class="headerlink" title="参考代码"></a>参考代码</h2><figure class="highlight c++"><figcaption><span>solution.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bitset&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(bitset&lt;<span class="number">16</span>&gt;&amp; x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// generate matrix A</span></span><br><span class="line">    array&lt;bitset&lt;16&gt;, 16&gt; A;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i != <span class="number">4</span>; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j != <span class="number">4</span>; ++j)</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k != <span class="number">4</span>; ++k) &#123;</span><br><span class="line">                A[i * <span class="number">4</span> + j].<span class="built_in">set</span>(i * <span class="number">4</span> + k);</span><br><span class="line">                A[i * <span class="number">4</span> + j].<span class="built_in">set</span>(k * <span class="number">4</span> + j);</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i != <span class="number">15</span>; ++i) &#123;</span><br><span class="line">        <span class="comment">// if A[i][i] is not a pivot</span></span><br><span class="line">        <span class="comment">// swap row i with the first row which has a pivot</span></span><br><span class="line">        <span class="keyword">if</span> (!A[i][i])</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j != <span class="number">16</span>; ++j)</span><br><span class="line">                <span class="keyword">if</span> (A[j][i]) &#123;</span><br><span class="line">                    <span class="built_in">swap</span>(A[j], A[i]);</span><br><span class="line">                    <span class="type">bool</span> tmp = x[j];</span><br><span class="line">                    x[j] = x[i];</span><br><span class="line">                    x[i] = tmp;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="comment">// eliminate</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j != <span class="number">16</span>; ++j)</span><br><span class="line">            <span class="keyword">if</span> (A[j][i]) &#123;</span><br><span class="line">                A[j] ^= A[i];</span><br><span class="line">                x[j] = x[j] ^ x[i];</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// eliminate</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">15</span>; i != <span class="number">0</span>; --i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i - <span class="number">1</span>; j &gt;= <span class="number">0</span>; --j)</span><br><span class="line">            <span class="keyword">if</span> (A[j][i]) &#123;</span><br><span class="line">                A[j] ^= A[i];</span><br><span class="line">                x[j] = x[j] ^ x[i];</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    bitset&lt;16&gt; x;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i != <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j != <span class="number">4</span>; ++j)</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">getchar</span>() == <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">                x.<span class="built_in">set</span>(i * <span class="number">4</span> + j);</span><br><span class="line">        <span class="built_in">getchar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">solve</span>(x);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%ld\n&quot;</span>, x.<span class="built_in">count</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i != <span class="number">16</span>; ++i)</span><br><span class="line">        <span class="keyword">if</span> (x[i])</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>, (i / <span class="number">4</span>) + <span class="number">1</span>, (i % <span class="number">4</span>) + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="article-tags is-size-7 is-uppercase" style="word-wrap:anywhere"> <span class="is-size-6 has-mr-8 has-text-grey rigid">#</span><a class="has-link-grey has-mr-6 rigid--link" href="/tags/linear-algebra/" rel="tag">Linear Algebra</a></div></div></div><div class="card card-transparent"><div class="level post-navigation is-flex-wrap is-mobile"><div class="level-start"><a class="level level-item has-link-grey article-nav-prev" href="/posts/nowcoder-2020-winter-camp-5/"><i class="level-item fas fa-chevron-left"></i> <span class="level-item">2020牛客寒假算法基础集训营5</span></a></div><div class="level-end"> <a class="level level-item has-link-grey article-nav-next" href="/posts/my-impression-of-hexo/"><span class="level-item">My Impression of Hexo</span><i class="level-item fas fa-chevron-right"></i></a></div></div></div><div class="card"><div class="card-content"><h3 class="title is-5 has-text-weight-normal">Comments</h3><div id="valine-thread" class="content"></div><script src="https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><script>new Valine({el:"#valine-thread",notify:!1,verify:!1,app_id:"jUDJCYuOij3UzEzFmRpQer5U-gzGzoHsz",app_key:"h2AVOMeF8QsLYFdVVbbf9d7k",placeholder:"Suggestions are welcome.",lang:"en"})</script></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start has-text-centered-mobile has-mb-6-mobile"><p>This work is licensed under a <a rel="license noopener external nofollow noreferrer" title="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons License</a></p></div><div class="level-end has-text-centered-mobile has-mb-5-mobile"><p class="is-size-7">&copy;&nbsp;2020<span style="padding-left:.06em">–</span>2023&nbsp;duinomaker<span>&nbsp;&nbsp;|&nbsp;&nbsp;</span><i class="fas fa-file-word"></i>&nbsp;57.5k&nbsp;words in total<span>&nbsp;&nbsp;|&nbsp;&nbsp;</span><a class="has-link-black-ter" rel="license noopener external nofollow noreferrer" title="Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"><i class="fab fa-creative-commons"></i>&nbsp;&nbsp;<i class="fab fa-creative-commons-by"></i>&nbsp;&nbsp;<i class="fab fa-creative-commons-nc"></i>&nbsp;&nbsp;<i class="fab fa-creative-commons-sa"></i></a></p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script>var IcarusThemeSettings={site:{url:"https://duinomaker.top",external_link:{enable:!0,exclude:[]}},article:{highlight:{clipboard:!0,fold:"true"}}}</script><script src="https://cdn.jsdelivr.net/npm/clipboard@latest/dist/clipboard.min.js" defer="defer"></script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js" defer="defer"></script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js" defer="defer"></script><script>document.addEventListener("DOMContentLoaded",function(){for(contents=document.getElementsByClassName("has-math"),i=0;i<contents.length;++i)renderMathInElement(contents[i],{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><script src="/assets/main.js" defer="defer"></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"> <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},CONTENT_URL:"/assets/content.json"}</script><script src="/assets/insight.js" defer="defer"></script><link rel="stylesheet" href="/assets/search.css"><link rel="stylesheet" href="/assets/insight.css"></body></html>